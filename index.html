<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON with Trail Conditions</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="map" style="height: 600px;"></div>

    <script>
        // Initialize the map
        var map = L.map('map').setView([60.731, -135.068], 13);  // Adjust view to your region

        // Set the OpenStreetMap basemap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Function to assign color based on condition value
        function getColor(condition) {
            switch (condition) {
                case 1: return 'red';
                case 2: return 'orange';
                case 3: return 'yellow';
                case 4: return 'green';
                case 5: return 'blue';
                default: return 'grey';
            }
        }

        // Fetch Google Sheets data using the published URL
        $.getJSON('https://spreadsheets.google.com/feeds/list/2PACX-1vRdbtilDhAQM77HRjymspR257EwZJ1U0i42JYVASWjhwk0WkPfTbnY0qOfkOSJ1ZqMUZVefQwmvIjpG/od6/public/values?alt=json', function(data) {
            // Map the Google Sheet rows into a key-value format for easy lookup
            var trailConditions = {};
            data.feed.entry.forEach(function(entry) {
                var trailName = entry.gsx$trail.$t.trim(); // Extract trail name
                var condition = parseInt(entry.gsx$condition.$t.trim()); // Extract condition
                var comments = entry.gsx$comments.$t.trim(); // Extract comments
                trailConditions[trailName] = {condition: condition, comments: comments};
            });

            // Function to create popups with the condition data
            function onEachFeature(feature, layer) {
                var trailName = feature.properties.Name;
                if (trailConditions[trailName]) {
                    var condition = trailConditions[trailName].condition;
                    var comments = trailConditions[trailName].comments;
                    layer.setStyle({ color: getColor(condition) });
                    layer.bindPopup('<strong>' + trailName + '</strong><br>Condition: ' + condition + '<br>Comments: ' + comments);
                }
            }

            // Load and display the GeoJSON files
            var geojsonFiles = [
                {name: 'ChilkootWay.geojson', url: 'path_to_your_geojson/ChilkootWay.geojson'},
                {name: 'LowerEscarpment.geojson', url: 'path_to_your_geojson/LowerEscarpment.geojson'},
                {name: 'Riverfront.geojson', url: 'path_to_your_geojson/Riverfront.geojson'}
            ];

            geojsonFiles.forEach(function(file) {
                $.getJSON(file.url, function(geojsonData) {
                    L.geoJSON(geojsonData, {
                        onEachFeature: onEachFeature
                    }).addTo(map);
                });
            });
        });
    </script>
</body>
</html>
